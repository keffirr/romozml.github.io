<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->  
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->  
<!--[if !IE]><!--> <html lang="ru"> <!--<![endif]-->  
<head>
<script data-ad-client="ca-pub-7665104717920613" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script data-ad-client="ca-pub-1379560078319874" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <title>Romoz</title>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Главная страница сайта">
    <meta name="author" content="Xiaoying Riley at 3rd Wave Media">
    <meta name="image" content="https://cdn.discordapp.com/attachments/473391350813818880/823083188371980288/20201212_162521.jpg">
    <meta name="yandex-verification" content="334146211218799b" />
    <meta property="og:locale" content="ru_RU"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Romoz Website"/>
    <meta property="og:description" content="Главная страница сайта"/>
    <meta property="og:image" content="https://romoz.ml/profile.png"/>
    <meta property="og:url" content="https://romoz.ml"/>
    <meta property="og:site_name" content="Discord - ❄Romoz❄#3171"/>  
    <link rel="shortcut icon" href="favicon.ico">  
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,300italic,400italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'> 
    <!-- Global CSS -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">   
    <!-- Plugins CSS -->
    <link rel="stylesheet" href="assets/plugins/font-awesome/css/font-awesome.css">
    
    <!-- github calendar css -->
    <link rel="stylesheet" href="assets/plugins/github-calendar/dist/github-calendar.css"
/>
    <!-- github acitivity css -->
    <link rel="stylesheet" href="assets/plugins/github-activity/src/github-activity.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/octicons/2.0.2/octicons.min.css">
    
    <!-- Theme CSS -->  
    <link id="theme-style" rel="stylesheet" href="assets/css/styles.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
</head> 

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LXL3TLRDX8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LXL3TLRDX8');
</script>
  <body>
    <h1 class ="page-header text-center">Страница, содержащая блок для голосования</h1>
 
    <div class="container">
      <div class="row">
        <div class="col-sm-offset-3 col-sm-6">
          <section class="panel panel-danger">
            <div class="panel-heading">
              <h3 class="panel-title">
                Голосование
              </h3>
            </div>
            <div class="panel-body">
            
              <!-- HTML-структура голосовалки -->
              <div class="question"></div>
              <hr>
              <div id="vote-section">              
                <form id="vote" action="poll-vote.php" method="POST">
                  <div class="answers"></div>
                  <button type="submit" class="btn btn-default" disabled="disabled">Голосовать</button>
                </form>
              </div>
              <!-- конец HTML-структура -->
              
            </div>
          </section>
        </div>
      </div>    
    </div>
 
    <!-- Javascript -->          
    <script type="text/javascript" src="assets/plugins/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>    
    <script type="text/javascript" src="assets/plugins/jquery-rss/dist/jquery.rss.min.js"></script> 
        <script>
      $(function(){
      
        var pathToPolls = 'polls.php';
        
        var vote = {};
        $.get(pathToPolls, function(data) {
          
          var data = JSON.parse(data);
          vote['id']=data['id'];
          vote['question']=data['question'];
          vote['answers']=data['answers'];

          if (data.hasOwnProperty('result')) {
            $('#vote').parent().parent().find('.question').text(vote['question']);
            var _answers = vote['answers'];
            var output = '';
            var result = data['result'];
            var totalvotes = 0;
            for (var i=0; i <= result.length-1; i++) {
              totalvotes += result[i];
            }
            for (var i=0; i <= result.length-1; i++) {
              output += '<p style="margin:0px;">'+_answers[i]+'</p>'+
                '<p class="text-right" style="margin:0px;"><b>'+((result[i]/totalvotes)*100).toFixed(1)+'%</b> (Голосов: '+result[i]+')</p>'+
                '<div class="progress">'+
                  '<div class="progress-bar progress-bar-info progress-bar-striped" role="progressbar" aria-valuenow="'+(result[i]/totalvotes)*100+'" aria-valuemin="0" aria-valuemax="100" style="width: '+(result[i]/totalvotes)*100+'%">'+
                    '<span class="sr-only">'+(result[i]/totalvotes)*100+'%</span>'+
                  '</div>'+
                '</div>';
            }
            $('#vote-section').html(output);
          } else {          
            processPoll();
          }
        });    

        var processPoll = function() {        
          var _id = vote['id'];
          var _answers = vote['answers'];
          var form = $('#vote');
          form.parent().parent().find('.question').text(vote['question']);
          form.prepend('<input type="hidden" name="count" value="'+vote['answers'].length+'">');
          form.prepend('<input type="hidden" name="id" value="'+vote['id']+'">');
          var answers = form.find('.answers');
          for (var i=0; i<=vote['answers'].length-1;i++) {
            answers.append('<div class="radio">'+
                '<label>'+
                  '<input type="radio" name="poll" value="'+(i+1)+'">'+
                  vote['answers'][i]+
                '</label>'+
              '</div>');
          }
          if (form.find('button[type="submit"]:disabled')) { 
            form.find('input[type="radio"]').click(function(){
              form.find('button[type="submit"]').prop('disabled',false);
              form.find('input[type="radio"]').off('click');  
            });          
          };
          
          form.submit(function(e) {
            //отмена действия по умолчанию для кнопки submit
            e.preventDefault();
            $.post(form.attr('action'), form.serializeArray(), function(data) {
              if (data) {
                var data = JSON.parse(data);
                var output = '';
                var result = data[_id];
                var totalvotes = 0;
                for (var i=0; i <= result.length-1; i++) {
                  totalvotes += result[i];
                }
                for (var i=0; i <= result.length-1; i++) {
                  output += '<p style="margin:0px;">'+_answers[i]+'</p>'+
                    '<p class="text-right" style="margin:0px;"><b>'+((result[i]/totalvotes)*100).toFixed(1)+'%</b> (Голосов: '+result[i]+')</p>'+
                    '<div class="progress">'+
                      '<div class="progress-bar progress-bar-info progress-bar-striped" role="progressbar" aria-valuenow="'+(result[i]/totalvotes)*100+'" aria-valuemin="0" aria-valuemax="100" style="width: '+(result[i]/totalvotes)*100+'%">'+
                        '<span class="sr-only">'+(result[i]/totalvotes)*100+'%</span>'+
                      '</div>'+
                    '</div>';
                }
                $('#vote-section').html(output);
              }
            }); 
          });
        };

      });
    <!-- github calendar plugin -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/es6-promise/3.0.2/es6-promise.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fetch/0.10.1/fetch.min.js"></script>
    <script type="text/javascript" src="assets/plugins/github-calendar/dist/github-calendar.min.js"></script>
    <!-- github activity plugin -->
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mustache.js/0.7.2/mustache.min.js"></script>
    <script type="text/javascript" src="assets/plugins/github-activity/src/github-activity.js"></script>
    <!-- custom js -->
    <script type="text/javascript" src="assets/js/main.js"></script>
</body>
</html> 
